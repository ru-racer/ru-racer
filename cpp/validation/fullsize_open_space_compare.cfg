# Compare bike vs 4-wheel model in open space (full-size params)

mode=validate
validate_models=both
output_root=cpp/results
seed=1234

# Integration / model
dt=0.02

# Vehicle constants (shared)
vehicle_m=1500.0
vehicle_Izz=2500.0
vehicle_lf=1.20
vehicle_lr=1.60
vehicle_h=0.50
vehicle_g=9.81
vehicle_track_b=1.60

# Bike tire model (nominal)
tiref_B=10.275
tiref_C=1.56
tiref_D=-0.85
tirer_B=10.275
tirer_C=1.56
tirer_D=-0.79

# 4-wheel tire model (Pacejka params from matlab/wheel_model.m as default)
tire_r=0.30
wheel_J=1.5
tire_B=11.275
tire_C=1.56
tire_D=-0.95
tire_E=-1.999
fourwheel_accel_limit=20.0

# Runtime-updatable friction scaling (multiplier on tire D)
friction_mu_scale_f0=1.0
friction_mu_scale_r0=1.0
friction_mu_scale_f_min=0.4
friction_mu_scale_f_max=1.3
friction_mu_scale_r_min=0.4
friction_mu_scale_r_max=1.3
friction_mu_speed_dependent=true
friction_mu_speed_vscale_mps=1.0

# Prevent unphysical reverse-speed drift in open-loop braking tests
model_clamp_vx_nonnegative=true

# Start state (shared pose/vel)
start_x=0.0
start_y=0.0
start_psi=0.0
start_vx=10.0
start_vy=0.0
start_r=0.0

# 4-wheel additional initial wheel speeds (rad/s). If 0, model will spin-up based on torque input.
start_dphi_fl=0.0
start_dphi_fr=0.0
start_dphi_rl=0.0
start_dphi_rr=0.0

# Control bounds
delta_max=0.5235987756
sfx_max=0.05

# Choose scenarios
validate_scenarios=accel_straight,brake_straight,turn_constant_steer,turn_sine_steer,mu_drop_sine_steer

# Cut longitudinal actuation to zero after this time (seconds) for selected scenarios
validate_lon_cutoff_s=5.0
validate_lon_cutoff_scenarios=turn_sine_steer,mu_drop_sine_steer

# Scenario timing
validate_t_accel=6.0
validate_t_brake=4.0
validate_t_turn=8.0
validate_t_sine=10.0
validate_t_mu_drop=10.0

# Bike longitudinal commands
validate_accel_sfx=0.04
validate_brake_sfx=-0.04
validate_cruise_sfx=0.01

# 4-wheel torque commands (rear-drive by default in validation)
validate4_tau_max=1500.0
validate4_accel_tau=900.0
validate4_brake_tau=-900.0
validate4_cruise_tau=250.0

# Motor torque vs speed (more physical than constant torque)
# validate4_torque_speed_model=CONSTANT|LINEAR|HYPERBOLIC
validate4_torque_speed_model=LINEAR
# LINEAR: torque scales by max(min_factor, 1 - |vx|/vmax)
validate4_torque_vmax_mps=40.0
validate4_torque_min_factor=0.0
# HYPERBOLIC: torque scales by 1/(1+|vx|/vref)
validate4_torque_vref_mps=20.0
# If true, apply the same drop model to negative torque (regen); if false, keep braking torque as commanded.
validate4_apply_drop_to_brake=false

# 4-wheel drivetrain layout for validation
# validate4_drive=RWD|FWD|AWD
validate4_drive=RWD
# For AWD only: fraction of total torque sent to front axle (0..1). Rear gets (1-split).
validate4_split_front=0.5

# Steering profile
validate_steer_const_rad=0.1745329252
validate_steer_sine_amp_rad=0.1396263402
validate_steer_sine_hz=0.25

# Friction drop scenario
validate_mu_f_start=1.0
validate_mu_r_start=1.0
validate_mu_f_end=0.6
validate_mu_r_end=0.6

# Plotting: car footprint
viz_car_width_m=1.90
viz_wheel_length_m=0.60
viz_car_poses_per_traj=5

